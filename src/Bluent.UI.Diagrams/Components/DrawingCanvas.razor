@inherits BluentComponentBase
@using Bluent.UI.Diagrams.Components.Internals
@using Bluent.UI.Diagrams.Elements.Diagram

<CascadingValue Value="this" IsFixed>
    <div @attributes=AdditionalAttributes
         id="@Id"
         class="@GetComponentClass()"
         style="@Style">
        <svg cursor="@Cursor"
             tabindex="0"
             @onpointerdown="HandlePointerDown"
             @onpointerup="HandlePointerUp"
             @onpointermove="HandlePointerMove"
             @onpointercancel="HandlePointerCancel"
             @onpointerenter="HandlePointerEnter"
             @onpointerout="HandlePointerOut"
             @onpointerleave="HandlePointerLeave"
             @onpointerover="HandlePointerOver"
             @onmousewheel="HandleMouseWheel"
             @onkeydown="HandleKeyDown"
             @onkeyup="HandleKeyUp">
            <defs>
                @GetDefinitions()
            </defs>
            @ChildContent

            @* <CanvasGround /> *@
            <g transform="translate(@(_pan.Dx + _activePan.Dx), @(_pan.Dy + _activePan.Dy)) scale(@_scale)">
                @foreach (var el in Elements.OrderBy(x => x.IsSelected).ThenBy(x => (x as IDiagramElementContainer)?.HasSelection ?? false))
                {
                    <ElementHost @key=el Element="el" />
                }
            </g>
        </svg>
        <div class="selection-options">
            @if (SelectedElements.Count() == 1)
            {
                var selection = SelectedElements.First();

                <div @key="selection" class="options" style="transform: translate(@(_pan.Dx + _activePan.Dx)px, @(_pan.Dy + _activePan.Dy)px) scale(@_scale)">
                    <div style="left: @(selection.Boundary.Right + 10)px; top: @(selection.Boundary.Y)px; padding: 5px;">
                        <CascadingValue Value="selection" IsFixed>
                            @selection.SelectionOptions
                        </CascadingValue>
                    </div>
                </div>
            }
        </div>
    </div>
</CascadingValue>
